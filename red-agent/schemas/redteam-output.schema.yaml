# Red Team Agent Output Schema
# Validates the structured output from red team analysis
#
# Note: This schema defines the expected structure for red team reports.
# Agents should produce output conforming to this schema.

$schema: "http://json-schema.org/draft-07/schema#"
$id: "redteam-output.schema.yaml"
title: "Red Team Analysis Output"
description: "Schema for red team analysis report structure"

type: object
required:
  - executive_summary
  - risk_overview
  - findings

properties:
  executive_summary:
    type: string
    minLength: 50
    description: "High-level summary of analysis results"

  risk_overview:
    type: object
    required:
      - overall_risk_level
      - categories
    properties:
      overall_risk_level:
        type: string
        enum: ["CRITICAL", "HIGH", "MEDIUM", "LOW", "INFO"]
      analysis_confidence:
        type: string
        pattern: "^\\d{1,3}%$"
      categories:
        type: array
        items:
          $ref: "#/definitions/risk_category"

  findings:
    type: object
    properties:
      critical:
        type: array
        items:
          $ref: "#/definitions/finding"
      high:
        type: array
        items:
          $ref: "#/definitions/finding"
      medium:
        type: array
        items:
          $ref: "#/definitions/finding"
      low:
        type: array
        items:
          $ref: "#/definitions/finding"

  patterns_detected:
    type: array
    items:
      $ref: "#/definitions/pattern"

  recommendations:
    type: object
    properties:
      immediate:
        type: array
        items:
          type: string
      short_term:
        type: array
        items:
          type: string
      long_term:
        type: array
        items:
          type: string

  limitations:
    type: object
    properties:
      scope:
        type: string
      coverage:
        type: string
      confidence_note:
        type: string
      temporal_note:
        type: string

  methodology:
    type: object
    properties:
      mode:
        type: string
        enum: ["quick", "standard", "deep"]
      grounding_enabled:
        type: boolean
      categories_analyzed:
        type: array
        items:
          type: string

definitions:
  risk_category:
    type: object
    required:
      - category
      - severity
    properties:
      category:
        type: string
        enum:
          - reasoning-flaws
          - assumption-gaps
          - context-manipulation
          - authority-exploitation
          - information-leakage
          - hallucination-risks
          - over-confidence
          - scope-creep
          - dependency-blindness
          - temporal-inconsistency
      severity:
        type: string
        enum: ["CRITICAL", "HIGH", "MEDIUM", "LOW", "NONE"]
      count:
        type: integer
        minimum: 0
      confidence:
        type: string
        pattern: "^\\d{1,3}%$"

  finding:
    type: object
    required:
      - id
      - category
      - severity
      - title
      - confidence
    properties:
      id:
        type: string
        pattern: "^[A-Z]{2,3}-\\d{3}$"
        description: "Finding ID (e.g., RF-001, AG-002)"
      category:
        type: string
      severity:
        type: string
        enum: ["CRITICAL", "HIGH", "MEDIUM", "LOW"]
      title:
        type: string
        minLength: 10
      confidence:
        type: string
        pattern: "^\\d{1,3}%$"
      evidence:
        type: object
        properties:
          quote:
            type: string
          source:
            type: string
          message_num:
            type: integer
      issue:
        type: string
        description: "Description of the issue"
      probing_question:
        type: string
        description: "Question to challenge the assumption"
      recommendation:
        type: string
      grounding_notes:
        type: object
        properties:
          evidence_strength:
            type: number
            minimum: 0
            maximum: 1
          notes:
            type: string

  pattern:
    type: object
    required:
      - name
      - description
    properties:
      name:
        type: string
      description:
        type: string
      instances:
        type: integer
        minimum: 1
